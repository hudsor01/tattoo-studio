FROM node:22-alpine

WORKDIR /app

# Copy package files first for better caching
COPY package*.json ./

# Copy Prisma schema before npm install
COPY prisma ./prisma/

# Install dependencies
RUN npm ci

# Copy the rest of the source code
COPY . .

# Generate Prisma client (not needed as postinstall already runs this)
# RUN npx prisma generate

# Run verification steps
RUN npm run lint
RUN npm run typecheck
RUN npm run build

# This image is not meant to be run, just built
